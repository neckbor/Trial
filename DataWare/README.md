# DataWare - Тестовое задание: Агрегатор авиабилетов

## Описание

Проект реализует сервис поиска и бронирования авиабилетов с архитектурой, основанной на принципах **чистой архитектуры**. Код разделён по слоям: `Domain`, `Application`, `Infrastructure`, `DataAccess`, `WebApi`.

Поиск осуществляется через агрегацию данных от нескольких внешних провайдеров (включены `AirTickets` и `SkyTickets`). Результаты кешируются с учётом времени жизни (TTL) и обрабатываются в фоне. В качестве кеша используется `MemoryCache`, однако, благодаря соблюдению принципов `SOLID`, текущая реализация легко заменяема — достаточно предоставить альтернативную реализацию базового интерфейса через механизм внедрения зависимостей (`DI`).

Код сопровождается набором модульных тестов, реализованных с использованием `xUnit`, `Moq` и `FluentAssertions`.

## Основной функционал

- Поиск авиабилетов по направлению, дате и количеству пассажиров
- Фильтрация и сортировка результатов (по цене, времени вылета, продолжительности, количеству пересадок, авиакомпании)
- Кеширование результатов поиска с контролем времени жизни (TTL)
- Оформление бронирования с передачей запроса соответствующему провайдеру
- Работа с предопределёнными справочниками (страны, города, аэропорты, авиакомпании)
- Документация API в формате Swagger/OpenAPI (версия 3.0.4)

## Ключевые интерфейсы и классы

- **`IFlightSearchService` / `FlightSearchService`**  
  Отвечает за создание запроса на поиск перелётов. Запускает процесс агрегации, обращаясь к `IFlightAggregator`. Также предоставляет доступ к данным запроса и результатам поиска.

- **`IFlightAggregator` / `FlightAggregator`**  
  Отвечает за выполнение поиска через всех зарегистрированных провайдеров. Перед запуском проверяет наличие результатов в кеше (`ISearchResultCache`). Если кеш неактуален — инициирует вызов провайдеров (`ITicketingProvider`) и сохраняет результат в кеш.

- **`ISearchResultCache`**  
  Интерфейс абстрагирует работу с кешем. Текущая реализация основана на `MemoryCache`, однако благодаря изоляции логики может быть заменена, например, на `Redis`. Хранит как список результатов (`List<BaseFlight>`), так и статус выполнения по каждому провайдеру (`Dictionary<TicketingProvider, SearchStatus>`).

- **`ITicketingProvider`**  
  Интерфейс для интеграции с внешними системами. Реализации (`AirTicketsTicketingProvider`, `SkyTicketsTicketingProvider`) отвечают за поиск и трансформацию данных провайдеров в унифицированную модель `BaseFlight`. Также поддерживают бронирование через `BookAsync`.

- **`BaseFlight`, `BaseSegment`, `FareDetails`**  
  Унифицированная модель результатов поиска. Включает в себя информацию о маршруте, сегментах, времени вылета/прилёта, цене и количестве доступных мест.

- **`SearchRequest`**  
  Агрегат, представляющий пользовательский запрос на поиск. Используется для хранения параметров, идентификации кеша и отслеживания состояния агрегации.


## Используемые технологии

- **.NET 8**
- **ASP.NET Core Web API**
- **Entity Framework Core** + **PostgreSQL**
- **Serilog** — логирование
- **MemoryCache** — кеширование
- **AutoMapper** — маппинг DTO
- **Swashbuckle** — генерация Swagger-документации
- **xUnit**, **Moq**, **FluentAssertions** — модульное тестирование
